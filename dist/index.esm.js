import e from"sfs-node";function r(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}function t(t){var s=t.logger,n=e({publicFolder:t.publicFolder,mask:t.mask,getFileById:t.getFileById,getFileByHash:t.getFileByHash,createFile:t.createFile,logger:s,allowDuplicates:t.allowDuplicates}),i=n.resolveFilePath,a=n.idToUrl,o=n.urlToId,u=n.saveFile,l=n.deleteFileByHash,d=n.deleteFileById,c=n.getDiskUsage,f=new Set;return{getFile:function(e,t){try{var n;return Promise.resolve(r(function(){if(n=a(e.params.id),s&&s("SFS Express: trying to return requested file: "+n,"info"),f.has(n))return t.status(428);var r=o(n);return Promise.resolve(i(r)).then(function(e){var r=e.filePath,n=e.fileName;return s&&s("SFS Express: sedning file '"+n+"' with path '"+r+"'"),t.setHeader("Content-Disposition",'inline; filename="'+n+'"'),t.status(200).sendFile(r)})},function(e){return s&&s("SFS Express: unable to return file:"+n),s&&s(e),t.status(404).send()}))}catch(e){return Promise.reject(e)}},idToUrl:a,urlToId:o,saveFile:u,prepareOptimisticUpload:function(e,r){try{var t=a(e.body.id);try{return f.add(t),Promise.resolve(r.status(200).send(t))}catch(e){return s&&s(e,"error"),Promise.resolve(r.status(500).send())}}catch(e){return Promise.reject(e)}},deleteFileByHash:l,deleteFileById:d,deleteFile:function(e,t){try{return Promise.resolve(r(function(){var r=a(e.params.id),s=o(r);return Promise.resolve(d(s)).then(function(){return t.status(200).send("ok")})},function(e){return s&&s(e,"error"),t.status(500).send()}))}catch(e){return Promise.reject(e)}},getDiskUsage:c,uploadFile:function(e,t,n){void 0===n&&(n={pathParamKey:"path",fileParamKey:"file",optimisticIdKey:"id"});try{if(!e.files)return Promise.resolve(t.status(400).send("Request doesn't contain any files"));var i,o=e.files[n.fileParamKey],l=e.body[n.pathParamKey],d=e.body[n.optimisticIdKey];return Promise.resolve(r(function(){return d&&(i=a(d)),Promise.resolve(u(o,l,d)).then(function(e){return e&&i&&f.delete(i),t.status(200).send(e)})},function(e){return s&&s(e,"error"),i&&f.delete(i),t.status(500).send()}))}catch(e){return Promise.reject(e)}},uploadFiles:function(e,t,n){void 0===n&&(n={pathParamKey:"path"});try{if(!e.files)return Promise.resolve(t.status(400).send("Request doesn't contain any files"));var i=n.pathParamKey;return Promise.resolve(r(function(){var r=e.body[i],s=[];return Object.values(e.files).forEach(function(e){Array.isArray(e)?s.push.apply(s,e):s.push(e)}),Promise.resolve(Promise.all(s.map(function(e){return u(e,r)}))).then(function(e){return t.status(200).send(e)})},function(e){return s&&s(e,"error"),t.status(500).send()}))}catch(e){return Promise.reject(e)}}}}export{t as default};
//# sourceMappingURL=index.esm.js.map
