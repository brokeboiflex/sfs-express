!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("sfs-node")):"function"==typeof define&&define.amd?define(["sfs-node"],r):(e||self).sfsExpress=r(e.sfsNode)}(this,function(e){function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=/*#__PURE__*/r(e);function n(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}return function(e){var r=e.logger,s=t.default({publicFolder:e.publicFolder,mask:e.mask,getFileById:e.getFileById,getFileByHash:e.getFileByHash,createFile:e.createFile,logger:r,allowDuplicates:e.allowDuplicates}),o=s.resolveFilePath,i=s.idToUrl,l=s.urlToId,a=s.saveFile,u=s.deleteFileByHash,c=s.deleteFileById,d=s.getDiskUsage,f=new Set;return{getFile:function(e,t){try{var s=e.protocol+"://"+e.get("host")+e.originalUrl;if(r&&r("SFS Express: trying to return requested file: "+s),f.has(s))return Promise.resolve(t.status(428));var i=l(s);return Promise.resolve(n(function(){return Promise.resolve(o(i)).then(function(e){var n=e.filePath,s=e.fileName;return r&&r("SFS Express: sedning file '"+s+"' with path '"+n+"'"),t.setHeader("Content-Disposition",'inline; filename="'+s+'"'),t.status(200).sendFile(n)})},function(e){return r&&r("SFS Express: unable to return file"+s),r&&r(e),console.error(e),t.status(404).send()}))}catch(e){return Promise.reject(e)}},idToUrl:i,urlToId:l,saveFile:a,prepareOptimisticUpload:function(e,r){try{var t=i(e.body.id);try{return f.add(t),Promise.resolve(r.status(200).send(t))}catch(e){return console.error(e),Promise.resolve(r.status(500).send())}}catch(e){return Promise.reject(e)}},deleteFileByHash:u,deleteFileById:c,deleteFile:function(e,r){try{return Promise.resolve(n(function(){var t=e.protocol+"://"+e.get("host")+e.originalUrl,n=l(t);return Promise.resolve(c(n)).then(function(){return r.status(200).send("ok")})},function(e){return console.error(e),r.status(500).send()}))}catch(e){return Promise.reject(e)}},getDiskUsage:d,uploadFile:function(e,r,t){void 0===t&&(t={pathParamKey:"path",fileParamKey:"file",optimisticIdKey:"id"});try{if(!e.files)return Promise.resolve(r.status(400).send("Request doesn't contain any files"));var s,o=e.files[t.fileParamKey],l=e.body[t.pathParamKey],u=e.body[t.optimisticIdKey];return Promise.resolve(n(function(){return u&&(s=i(u)),Promise.resolve(a(o,l,u)).then(function(e){return e&&s&&f.delete(s),r.status(200).send(e)})},function(e){return console.error(e),s&&f.delete(s),r.status(500).send()}))}catch(e){return Promise.reject(e)}},uploadFiles:function(e,r,t){void 0===t&&(t={pathParamKey:"path"});try{if(!e.files)return Promise.resolve(r.status(400).send("Request doesn't contain any files"));var s=t.pathParamKey;return Promise.resolve(n(function(){var t=e.body[s],n=[];return Object.values(e.files).forEach(function(e){Array.isArray(e)?n.push.apply(n,e):n.push(e)}),Promise.resolve(Promise.all(n.map(function(e){return a(e,t)}))).then(function(e){return r.status(200).send(e)})},function(e){return console.error(e),r.status(500).send()}))}catch(e){return Promise.reject(e)}}}}});
//# sourceMappingURL=index.umd.js.map
