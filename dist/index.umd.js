!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("sfs-node")):"function"==typeof define&&define.amd?define(["sfs-node"],t):(e||self).sfsExpress=t(e.sfsNode)}(this,function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=/*#__PURE__*/t(e);function n(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}return function(e){var t=r.default({publicFolder:e.publicFolder,mask:e.mask,getFileById:e.getFileById,getFileByHash:e.getFileByHash,createFile:e.createFile,logger:e.logger,allowDuplicates:e.allowDuplicates}),s=t.resolveFilePath,o=t.idToUrl,i=t.urlToId,a=t.saveFile,l=t.deleteFileByHash,u=t.deleteFileById,c=t.getDiskUsage,d=new Set;return{getFile:function(e,t){try{var r=e.protocol+"://"+e.get("host")+e.originalUrl;if(d.has(r))return Promise.resolve(t.status(425));var o=i(r);return Promise.resolve(n(function(){return Promise.resolve(s(o)).then(function(e){var r=e.filePath;return t.setHeader("Content-Disposition",'inline; filename="'+e.fileName+'"'),t.status(200).sendFile(r)})},function(){return t.status(404).send()}))}catch(e){return Promise.reject(e)}},idToUrl:o,urlToId:i,saveFile:a,prepareOptimisticUpload:function(e,t){try{var r=i(e.body.id);try{return d.add(r),Promise.resolve(t.status(200).send(r))}catch(e){return console.error(e),Promise.resolve(t.status(500).send())}}catch(e){return Promise.reject(e)}},deleteFileByHash:l,deleteFileById:u,deleteFile:function(e,t){try{return Promise.resolve(n(function(){var r=e.protocol+"://"+e.get("host")+e.originalUrl,n=i(r);return Promise.resolve(u(n)).then(function(){return t.status(200).send("ok")})},function(e){return console.error(e),t.status(500).send()}))}catch(e){return Promise.reject(e)}},getDiskUsage:c,uploadFile:function(e,t,r){void 0===r&&(r={pathParamKey:"path",fileParamKey:"file",optimisticIdKey:"id"});try{if(!e.files)return Promise.resolve(t.status(400).send("Request doesn't contain any files"));var s,i=e.files[r.fileParamKey],l=e.body[r.pathParamKey],u=e.body[r.optimisticIdKey];return Promise.resolve(n(function(){return u&&(s=o(u)),Promise.resolve(a(i,l,u)).then(function(e){return e&&s&&d.delete(s),t.status(200).send(e)})},function(e){return console.error(e),s&&d.delete(s),t.status(500).send()}))}catch(e){return Promise.reject(e)}},uploadFiles:function(e,t,r){void 0===r&&(r={pathParamKey:"path"});try{if(!e.files)return Promise.resolve(t.status(400).send("Request doesn't contain any files"));var s=r.pathParamKey;return Promise.resolve(n(function(){var r=e.body[s],n=[];return Object.values(e.files).forEach(function(e){Array.isArray(e)?n.push.apply(n,e):n.push(e)}),Promise.resolve(Promise.all(n.map(function(e){return a(e,r)}))).then(function(e){return t.status(200).send(e)})},function(e){return console.error(e),t.status(500).send()}))}catch(e){return Promise.reject(e)}}}}});
//# sourceMappingURL=index.umd.js.map
